<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>

<sqlMap namespace="musicSQL">
	
	<typeAlias alias="musicDTO" type="upload.dto.musicDTO"/>
	<typeAlias alias="searchDTO" type="upload.dto.searchDTO"/>
	<typeAlias alias="singerDTO" type="upload.dto.singerDTO"/>

	<typeAlias alias="musicDTO2" type="upload.dto.musicDTO2"/>
<<<<<<< HEAD

=======
>>>>>>> 0dd606efad5d4721a3390680216d4987a05887af
	<typeAlias alias="albumDTO" type="upload.dto.albumDTO"/>
	<typeAlias alias="lyricsDTO" type="upload.dto.lyricsDTO"/>

	
	<resultMap id="musicRes" class="musicDTO">
		<result property="num" column="num"/>
		<result property="music_name" column="music_name"/>
		<result property="music_image" column="music_image"/>
		<result property="genre" column="genre"/>
		<result property="singer" column="singer"/>
		<result property="album" column="album"/>
		<result property="title" column="title"/>
		<result property="hit" column="hit"/>
		<result property="realname_music" column="realname_music" />
		<result property="realname_image" column="realname_image" />
		<result property="minute" column="minute" />
	</resultMap>
	
	<resultMap id="musicSearchRes" class="searchDTO">
		<result property="genre" column="genre"/>
		<result property="singer" column="singer"/>
		<result property="album" column="album"/>
		<result property="title" column="title"/>
	</resultMap>
	
<<<<<<< HEAD

=======
>>>>>>> 0dd606efad5d4721a3390680216d4987a05887af
	<resultMap id="musicRes2" class="musicDTO2">
		<result property="id" column="id"/>
		<result property="limit" column="limit"/>
	</resultMap>
<<<<<<< HEAD
	
=======

>>>>>>> 0dd606efad5d4721a3390680216d4987a05887af
	<resultMap id="singerRes" class="singerDTO">
		<result property="singer" column="singer"/>
		<result property="year" column="year"/>
		<result property="birth" column="birth"/>
		<result property="maingenre" column="maingenre"/>
		<result property="entertain" column="entertain"/>
		<result property="p_hit" column="p_hit"/>
	</resultMap>
	
	<resultMap id="albumRes" class="albumDTO">
		<result property="name" column="name"/>
		<result property="singer" column="singer"/>
		<result property="year" column="year"/>
		<result property="publisher" column="publisher"/>
		<result property="entertain" column="entertain"/>
		<result property="genre" column="genre"/>
<<<<<<< HEAD
=======

>>>>>>> 0dd606efad5d4721a3390680216d4987a05887af
	</resultMap>
	
	<resultMap id="lyricsRes" class="lyricsDTO">
		<result property="name" column="name"/>
		<result property="lyrics" column="lyrics"/>
	</resultMap>
	
	<!-- 공통적으로 사용할 select 절 정의 -->
	<sql id="select-all">
		SELECT * FROM bbu_board
	</sql>
	
	<sql id="where-num">
		WHERE num = #num#
	</sql>
	
	<!-- select 쿼리문 정의 -->
		<select id="selectLastNum" resultClass="int">
			SELECT max(num) FROM bbu_BOARD 
		</select>
		
		<select id="selectAll" resultMap="musicRes" parameterClass="musicDTO">
			<include refid="select-all" />
			ORDER BY hit DESC
		</select>
		<select id="newSelectAll" resultMap="musicRes" parameterClass="musicDTO">
			<include refid="select-all" />
			ORDER BY num DESC
		</select>
		<select id="genreSelectAll" resultMap="musicRes" parameterClass="String">
			<include refid="select-all" />
			 where genre = #type# ORDER BY num DESC
		</select>
		
		<select id="search_Test" resultMap="musicSearchRes" parameterClass="searchDTO">
			<include refid="select-all" />
			where genre like '%' || #genre# || '%'
			or singer like '%' || #singer# || '%'
			or album like '%' || #album# || '%'
			or title like '%' || #title# || '%'
			ORDER BY num DESC
		</select>
		
		<select id="selectWithSinger" resultMap="singerRes" parameterClass="String">
			 SELECT * FROM singer_info where singer = #singer#
		</select>
		
		<select id="selectWithAlbum" resultMap="albumRes" parameterClass="String">
			 SELECT * FROM album_info where album = #album#
		</select>
		
		<select id="SingerChk" resultClass="String" parameterClass="String">
			SELECT singer FROM album_info where singer = #singer#
		</select>
		
<<<<<<< HEAD
		<select id="benefit" resultClass="String" parameterClass="musicDTO2" >
			select pay_benefit from bbu_paymyinfo where pay_benefit like '%' || #limit# || '%'  and my_id = #id#
		</select>
=======

		<select id="benefit" resultClass="String" parameterClass="musicDTO2" >
			select pay_benefit from bbu_paymyinfo where pay_benefit like '%' || #limit# || '%'  and my_id = #id#
		</select>

>>>>>>> 0dd606efad5d4721a3390680216d4987a05887af
		<select id="AlbumChk" resultClass="String" parameterClass="String">
			SELECT album FROM album_info where album = #album#
		</select>
		
		
	<!-- insert 쿼리문 정의 -->
	<insert id="insertMusic" parameterClass="musicDTO">
		INSERT INTO BBU_BOARD (NUM,
							MUSIC_NAME,
							MUSIC_IMAGE,
							GENRE,
							SINGER,
							ALBUM,
							TITLE,
							HIT,
							REALNAME_MUSIC,
							REALNAME_IMAGE,
							MINUTE
							)
					VALUES (bbu_seq.NEXTVAL,
							#music_name#,
							#music_image#,
							#genre#,
							#singer#,
							#album#,
							#title#,
							0,
							#realname_music#,
							#realname_image#,
							#minute#
							)
	</insert>
	<insert id="insertSinger" parameterClass="singerDTO">
		INSERT INTO SINGER_INFO (SINGER,
								YEAR,
								BIRTH,
								MAINGENRE,
								ENTERTAIN,
								P_HIT
								)
						VALUES (#singer#,
								#year#,
								#birth#,
								#maingenre#,
								#entertain#,
								#p_hit#
								)
	</insert>
	<insert id="insertAlbum" parameterClass="albumDTO">
		INSERT INTO ALBUM_INFO (NAME,
								SINGER,
								YEAR,
								PUBLISHER,
								ENTERTAIN,
								GENRE
								)
						VALUES (#name#,
								#singer#,
								#year#,
								#publisher#,
								#entertain#,
								#genre#
								)
	</insert >
	<insert id="insertLyrics" parameterClass="lyricsDTO">
		INSERT INTO LYRICS_INFO (NAME,
								LYRICS
								)
						VALUES (#name#,
								#lyrics#
								)
	</insert>
	<!-- delete 쿼리문 정의 -->
	<delete id="deleteSinger" parameterClass="String">
		DELETE FROM SINGER_INFO where singer = #singer#
	</delete>
	<delete id="deleteAlbum" parameterClass="String">
		DELETE FROM ALBUM_INFO where name = #album#
	</delete>
	<delete id="deleteLyrics" parameterClass="String">
		DELETE FROM LYRICS_INFO where name = #name#
	</delete>
</sqlMap>